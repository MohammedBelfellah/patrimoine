{% extends "core/base.html" %}
{% block title %}Gestion des utilisateurs{% endblock %}
{% block content %}
<div class="card">
    <h2>üë• Gestion des utilisateurs</h2>
    <p class="muted">Assignez les r√¥les (ADMIN, INSPECTEUR) aux utilisateurs.</p>

    {% if users %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
        <thead>
            <tr style="background: #f0f0f0;">
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Email</th>
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Groupes</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 10px;">
                    <strong>{{ user.email }}</strong>
                    {% if user.is_superuser %}<br><span style="color: #d97706; font-size: 0.85em;">‚≠ê Superadmin</span>{%
                    endif %}
                </td>
                <td style="padding: 10px;">
                    {% with groups=user.groups.values_list 'name' flat=True %}
                    {% if groups %}
                    {% for g in groups %}<span
                        style="background: #dbeafe; padding: 4px 8px; border-radius: 4px; margin-right: 4px;">{{ g
                        }}</span>{% endfor %}
                    {% else %}
                    <span class="muted">Aucun r√¥le</span>
                    {% endif %}
                    {% endwith %}
                </td>
                <td style="padding: 10px; text-align: center;">
                    <form method="post" action="{% url 'toggle-user-group' user_id=user.id group_name='ADMIN' %}"
                        style="display: inline-block; margin-right: 8px;">
                        {% csrf_token %}
                        <button type="submit"
                            style="padding: 6px 12px; background: {% if 'ADMIN' in groups %}#ef4444{% else %}#10b981{% endif %}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                            {% if 'ADMIN' in groups %}Retirer ADMIN{% else %}Ajouter ADMIN{% endif %}
                        </button>
                    </form>
                    <form method="post" action="{% url 'toggle-user-group' user_id=user.id group_name='INSPECTEUR' %}"
                        style="display: inline-block;">
                        {% csrf_token %}
                        <button type="submit"
                            style="padding: 6px 12px; background: {% if 'INSPECTEUR' in groups %}#ef4444{% else %}#10b981{% endif %}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                            {% if 'INSPECTEUR' in groups %}Retirer INSPECTEUR{% else %}Ajouter INSPECTEUR{% endif %}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="muted">Aucun utilisateur trouv√©.</p>
    {% endif %}
</div>
{% endblock %}