{% extends "core/base.html" %}
{% block title %}Inspections{% endblock %}
{% block content %}
<div class="card">
  <h2>üìã Inspections</h2>

  {% if can_add %}
  <div style="margin-bottom: 16px;">
    <a href="{% url 'inspection-create' %}" class="btn btn-primary">+ Ajouter une inspection</a>
  </div>
  {% endif %}

  {% if is_admin and pending_requests %}
  <div style="background: #fef9c3; border: 2px solid #ca8a04; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
    <h3 style="margin-top: 0; color: #854d0e;">‚ö†Ô∏è Demandes de modification en attente ({{ pending_requests|length }})</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #fef3c7;">
          <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ca8a04;">Patrimoine</th>
          <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ca8a04;">Inspecteur</th>
          <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ca8a04;">Date demande</th>
          <th style="padding: 8px; text-align: center; border-bottom: 1px solid #ca8a04;">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for req in pending_requests %}
        <tr style="border-bottom: 1px solid #fde68a;">
          <td style="padding: 8px;">{{ req.id_inspection.id_patrimoine.nom_fr }}</td>
          <td style="padding: 8px;">{{ req.requested_by.email }}</td>
          <td style="padding: 8px;">{{ req.requested_at|date:"d/m/Y H:i" }}</td>
          <td style="padding: 8px; text-align: center;">
            <a href="{% url 'inspection-detail' req.id_inspection.id_inspection %}" class="btn btn-primary" style="padding: 4px 12px; font-size: 13px;">Examiner</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  {% if inspections %}
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background: #f0f0f0;">
        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Patrimoine</th>
        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Date</th>
        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">√âtat</th>
        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Inspecteur</th>
        <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for insp in inspections %}
      <tr style="border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;">{{ insp.id_patrimoine.nom_fr }}</td>
        <td style="padding: 10px;">{{ insp.date_inspection|date:"d/m/Y" }}</td>
        <td style="padding: 10px;"><strong>{{ insp.get_etat_display }}</strong></td>
        <td style="padding: 10px;">{{ insp.id_inspecteur.email }}</td>
        <td style="padding: 10px; text-align: center;">
          <a href="{% url 'inspection-detail' insp.id_inspection %}" class="btn btn-secondary" style="padding: 4px 12px; font-size: 13px;">Voir</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">Aucune inspection enregistr√©e.</p>
  {% endif %}
</div>

<style>
  .btn { display: inline-block; padding: 6px 12px; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
  .btn-primary { background: #1d4ed8; color: white; }
  .btn-secondary { background: #6b7280; color: white; }
  .btn:hover { opacity: 0.9; }
</style>
{% endblock %}
