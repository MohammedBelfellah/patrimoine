{% extends "core/base.html" %}
{% block title %}{{ patrimoine.nom_fr }}{% endblock %}
{% block content %}
<div class="card">
  <h2>{{ patrimoine.nom_fr }}</h2>
  <p class="muted"><small>{{ patrimoine.full_location }}</small></p>

  <div style="margin-bottom: 16px;">
    {% if patrimoine.nom_ar %}
    <p><strong>Nom arabe:</strong> {{ patrimoine.nom_ar }}</p>
    {% endif %}
    <p><strong>Type:</strong> {{ patrimoine.get_type_patrimoine_display }}</p>
    <p><strong>Statut:</strong> {{ patrimoine.get_statut_display }}</p>
    {% if patrimoine.reference_administrative %}
    <p><strong>Référence administrative:</strong> {{ patrimoine.reference_administrative }}</p>
    {% endif %}
    {% if patrimoine.description %}
    <p><strong>Description:</strong></p>
    <p>{{ patrimoine.description }}</p>
    {% endif %}
    <p><strong>Créé par:</strong> {{ patrimoine.created_by.email }} ({{ patrimoine.created_at|date:"d/m/Y H:i" }})</p>
    <p><strong>Mis à jour:</strong> {{ patrimoine.updated_at|date:"d/m/Y H:i" }}</p>
  </div>

  {% if images %}
  <div style="margin-bottom: 16px;">
    <h3><i class="bi bi-images"></i> Images ({{ images|length }})</h3>
    <div
      style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-top: 12px;">
      {% for image in images %}
      <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; position: relative;">
        <img src="/media/{{ image.file_path }}" alt="{{ image.file_name }}"
          style="width: 100%; height: 200px; object-fit: cover;">
        <div style="padding: 8px; background: #f9fafb;">
          <p style="margin: 0; font-size: 12px; color: #666; word-break: break-all;">{{ image.file_name }}</p>
          <p style="margin: 4px 0 0 0; font-size: 11px; color: #999;">{{ image.file_size_mb }} MB - {{
            image.uploaded_at|date:"d/m/Y" }}</p>
          {% if can_edit or user == image.uploaded_by %}
          <form method="post" action="{% url 'document-delete' image.id_document %}" style="margin-top: 8px;"
            onsubmit="return confirm('Supprimer cette image?');">
            {% csrf_token %}
            <button type="submit"
              style="padding: 4px 8px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; width: 100%;"><i
                class="bi bi-trash"></i> Supprimer</button>
          </form>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div style="margin-bottom: 16px;">
    {% if can_edit %}
    <a href="{% url 'patrimoine-edit' patrimoine.id_patrimoine %}" class="btn btn-primary">Éditer</a>
    {% if user.is_superuser %}
    <form method="post" action="{% url 'patrimoine-delete' patrimoine.id_patrimoine %}" style="display:inline;"
      onsubmit="return confirm('Confirmer suppression?');">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger">Supprimer</button>
    </form>
    {% endif %}
    {% endif %}
    <a href="{% url 'patrimoine-list' %}" class="btn btn-secondary">Retour</a>
  </div>
</div>
{% endblock %}